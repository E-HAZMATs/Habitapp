<div class="flex flex-col items-center px-4 py-6 w-full max-w-3xl mx-auto gap-4">
  <h2 class="self-start font-bold text-xl ms-1">{{ 'habitLog' | translate }}</h2>
  <mat-divider class="w-full" />
 <!-- todo add active page style. -->

  @if (loading()) {
    <div class="flex justify-center items-center py-16 w-full">
      <mat-spinner diameter="48" />
    </div>
  }

  @if (!loading() && logs().length === 0) {
    <div class="flex flex-col items-center justify-center py-20 gap-3 text-gray-400">
      <mat-icon class="text-5xl !w-12 !h-12">inbox</mat-icon>
      <p class="text-base">{{ 'noLogs' | translate }}</p>
    </div>
  }

  @if (!loading() && logs().length > 0) {
    <div class="flex flex-col gap-3 w-full">
      @for (log of logs(); track log.id) {
        <mat-card>
          <mat-card-content class="!grid grid-cols-[1fr_auto_180px] items-center gap-x-4 py-3 px-4">

            <div class="flex flex-col gap-0.5 min-w-0">
              <span class="font-medium text-base truncate">{{ log.Habit.name }}</span>
              @if (log.Habit.description) {
                <span class="text-sm text-gray-500 truncate">{{ log.Habit.description }}</span>
              }
            </div>
            <!-- When no description, this looks bad. -->
             <!-- Should chips be of same width? -->
            <div class="flex items-center">
              <mat-chip
                [class]="
                  log.status === 'completed' ? 'chip-completed' :
                  log.status === 'missed'    ? 'chip-missed' :
                                               'chip-skipped'"
                class="text-xs !h-6">
                {{ log.status | translate }}
              </mat-chip>
            </div>

            <div class="flex flex-col items-start gap-1 text-m">
              <span>
                <span class="date-label">{{ 'dueDate' | translate }}:</span>
                <!-- TODO: Handle arabic date -->
                {{ log.dueDate | date:'mediumDate' }} 
              </span>
              @if (log.status === 'completed' && log.completedAt) {
                <span>
                  <span class="date-label">{{ 'completedAt' | translate }}:</span>
                  {{ log.completedAt | date:'medium' }}
                </span>
              }
            </div>

          </mat-card-content>
        </mat-card>
      }
    </div>

    @if (pagination() && pagination()!.totalPages > 1) {
      <div class="flex items-center justify-center flex-wrap gap-1 pt-2">
        <button mat-icon-button
          [disabled]="!pagination()!.hasPreviousPage"
          (click)="loadLogs(currentPage() - 1)"
          class="pagination-button">
          <mat-icon class="rtl:rotate-180">chevron_left</mat-icon>
        </button>

        @if (showFirstPage()) {
          <button mat-icon-button (click)="loadLogs(1)" class="pagination-button">
            <span class="text-sm font-medium">1</span>
          </button>
        }
        @if (showStartEllipsis()) {
          <span class="px-1 select-none pagination-ellipsis">…</span>
        }

        @for (page of getPageNumbers(); track page) {
          <button mat-icon-button
            (click)="loadLogs(page)"
            class="pagination-button">
            <span class="text-sm font-medium">{{ page }}</span>
          </button>
        }

        @if (showEndEllipsis()) {
          <span class="px-1 select-none pagination-ellipsis">…</span>
        }
        @if (showLastPage()) {
          <button mat-icon-button (click)="loadLogs(pagination()!.totalPages)" class="pagination-button">
            <span class="text-sm font-medium">{{ pagination()!.totalPages }}</span>
          </button>
        }

        <button mat-icon-button
          [disabled]="!pagination()!.hasNextPage"
          (click)="loadLogs(currentPage() + 1)"
          class="pagination-button">
          <mat-icon class="rtl:rotate-180">chevron_right</mat-icon>
        </button>
      </div>
    }
  }
</div>
